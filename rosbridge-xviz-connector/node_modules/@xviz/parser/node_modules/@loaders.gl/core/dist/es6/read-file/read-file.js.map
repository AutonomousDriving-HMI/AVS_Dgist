{"version":3,"sources":["../../../src/read-file/read-file.js"],"names":["fs","http","https","util","resolvePath","decodeDataUri","toArrayBuffer","concatenateReadStream","isNode","Boolean","readFile","DEFAULT_OPTIONS","dataType","getReadFileOptions","options","Object","assign","responseType","encoding","uri","startsWith","Promise","resolve","File","readFileObject","isRequest","reject","URL","request","response","then","readFileNode","location","href","fetch","res","error","message","readFileSync","buffer","Buffer","file","reader","FileReader","onerror","Error","onabort","onload","result","readAsText","readAsArrayBuffer","filename","readFileAsync","promisify"],"mappings":"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","sourcesContent":["/* global fetch */\n/* global URL, location, File, FileReader */\n/* global Buffer */\nimport fs from 'fs'; // `fs` will be empty object in browsers (see package.json \"browser\" field).\nimport http from 'http';\nimport https from 'https';\nimport util from 'util';\n\nimport {resolvePath} from './file-aliases';\nimport decodeDataUri from '../data-uri-utils/decode-data-uri';\nimport {toArrayBuffer} from '../binary-utils/binary-utils';\nimport {concatenateReadStream} from '../async-iterator-utils/stream-utils';\n\nconst isNode = Boolean(fs && fs.readFile);\n\nconst DEFAULT_OPTIONS = {\n  dataType: 'arrayBuffer'\n};\n\nfunction getReadFileOptions(options = {}) {\n  options = Object.assign({}, DEFAULT_OPTIONS, options);\n  options.responseType = options.responseType || options.dataType;\n  if (fs) {\n    // set encoding for fs.readFile\n    options.encoding = options.encoding || (options.dataType === 'text' ? 'utf8' : null);\n  }\n  return options;\n}\n\n// Reads raw file data from:\n// * http/http urls\n// * data urls\n// * File/Blob objects\n// etc?\nexport function readFile(uri, options = {}) {\n  try {\n    uri = resolvePath(uri);\n    options = getReadFileOptions(options);\n\n    if (uri.startsWith('data:')) {\n      return Promise.resolve(decodeDataUri(uri));\n    }\n\n    if (typeof File !== 'undefined' && uri instanceof File) {\n      readFileObject(uri, options);\n    }\n\n    if (isNode) {\n      const isRequest = uri.startsWith('http:') || uri.startsWith('https:');\n      if (isRequest) {\n        return new Promise((resolve, reject) => {\n          options = {...new URL(uri), ...options};\n          const request = uri.startsWith('https:') ? https.request : http.request;\n          request(uri, response => concatenateReadStream(response).then(resolve, reject));\n        });\n      }\n\n      return readFileNode(uri, options);\n    }\n\n    // Browser: Try to load all URLS via fetch, as they can be local requests (e.g. to a dev server)\n    // In a web worker, XMLHttpRequest throws invalid URL error if using relative path\n    // resolve url relative to original base\n    uri = new URL(uri, location.href).href;\n    return fetch(uri, options).then(res => res[options.dataType]());\n\n    // return Promise.reject(new Error('Cannot load file URIs in browser'));\n  } catch (error) {\n    return Promise.reject(error.message);\n  }\n}\n\n// In a few cases (data URIs, node.js) \"files\" can be read synchronously\nexport function readFileSync(uri, options = {}) {\n  uri = resolvePath(uri);\n  options = getReadFileOptions(options);\n\n  if (uri.startsWith('data:')) {\n    return decodeDataUri(uri);\n  }\n\n  if (!isNode) {\n    return null; // throw new Error('Cant load URI synchronously');\n  }\n\n  const buffer = fs.readFileSync(uri, options, () => {});\n  return buffer instanceof Buffer ? toArrayBuffer(buffer) : buffer;\n}\n\n// HELPERS\n\n/**\n * File reader function for the browser\n * @param {File|Blob} file  HTML File or Blob object to read as string\n * @returns {Promise.string}  Resolves to a string containing file contents\n */\nfunction readFileObject(file, options) {\n  return new Promise((resolve, reject) => {\n    try {\n      const reader = new FileReader();\n      reader.onerror = error => reject(new Error(error));\n      reader.onabort = () => reject(new Error('Read operation was aborted.'));\n      reader.onload = () => resolve(reader.result);\n      if (options.dataType !== 'arraybuffer') {\n        reader.readAsText(file);\n      } else {\n        reader.readAsArrayBuffer(file);\n      }\n    } catch (error) {\n      reject(error);\n    }\n  });\n}\n\nfunction readFileNode(filename, options) {\n  const readFileAsync = util.promisify(fs.readFile);\n  return readFileAsync(filename, options).then(\n    buffer => buffer instanceof Buffer ? toArrayBuffer(buffer) : buffer\n  );\n}\n\n"],"file":"read-file.js"}