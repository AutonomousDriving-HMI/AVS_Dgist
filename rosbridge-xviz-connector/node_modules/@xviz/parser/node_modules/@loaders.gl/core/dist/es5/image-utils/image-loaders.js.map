{"version":3,"sources":["../../../src/image-utils/image-loaders.js"],"names":["ImageBitmapLoader","parse","parseToImageBitmap","HTMLImageLoader","load","loadToHTMLImage","PlatformImageLoader","parseToPlatformImage","loadToPlatformImage","arrayBuffer","blob","Blob","Uint8Array","createImageBitmap","url","options","promise","test","dataType","then","xml","Promise","resolve","src","reject","image","Image","onload","onerror","err","Error","crossOrigin","error"],"mappings":";;;;;;;AACA;;AADA;AAGA;AACO,IAAMA,iBAAiB,GAAG;AAC/BC,EAAAA,KAAK,EAAEC;AADwB,CAA1B,C,CAIP;;;AACO,IAAMC,eAAe,GAAG;AAC7BC,EAAAA,IAAI,EAAEC;AADuB,CAAxB,C,CAIP;;;AACO,IAAMC,mBAAmB,GAAG;AACjCL,EAAAA,KAAK,EAAEM,oBAD0B;AAEjCH,EAAAA,IAAI,EAAEI;AAF2B,CAA5B,C,CAKP;AACA;AAEA;;;;AACA,SAASN,kBAAT,CAA4BO,WAA5B,EAAyC;AACvC,MAAMC,IAAI,GAAG,IAAIC,IAAJ,CAAS,CAAC,IAAIC,UAAJ,CAAeH,WAAf,CAAD,CAAT,CAAb;AACA,SAAOI,iBAAiB,CAACH,IAAD,CAAxB;AACD;;AAED,SAASL,eAAT,CAAyBS,GAAzB,EAA8BC,OAA9B,EAAuC;AACrC,MAAIC,OAAJ;;AACA,MAAI,oBAAoBC,IAApB,CAAyBH,GAAzB,CAAJ,EAAmC;AACjC;AACAE,IAAAA,OAAO,GAAG,wBAASF,GAAT,EAAc;AAACI,MAAAA,QAAQ,EAAE;AAAX,KAAd,EACPC,IADO,CACF,UAAAC,GAAG;AAAA,wDAAwCA,GAAxC;AAAA,KADD,CAAV;AAED,GAJD,MAIO;AACLJ,IAAAA,OAAO,GAAGK,OAAO,CAACC,OAAR,CAAgBR,GAAhB,CAAV;AACD;;AACD,SAAOE,OAAO,CAACG,IAAR,CAAa,UAAAI,GAAG;AAAA,WAAI,IAAIF,OAAJ,CAAY,UAACC,OAAD,EAAUE,MAAV,EAAqB;AAC1D,UAAI;AACF,YAAMC,KAAK,GAAG,IAAIC,KAAJ,EAAd;;AACAD,QAAAA,KAAK,CAACE,MAAN,GAAe;AAAA,iBAAML,OAAO,CAACG,KAAD,CAAb;AAAA,SAAf;;AACAA,QAAAA,KAAK,CAACG,OAAN,GAAgB,UAACC,GAAD;AAAA,iBAASL,MAAM,CAAC,IAAIM,KAAJ,gCAAkChB,GAAlC,eAA0Ce,GAA1C,EAAD,CAAf;AAAA,SAAhB;;AACAJ,QAAAA,KAAK,CAACM,WAAN,GAAqBhB,OAAO,IAAIA,OAAO,CAACgB,WAApB,IAAoC,WAAxD;AACAN,QAAAA,KAAK,CAACF,GAAN,GAAYA,GAAZ;AACD,OAND,CAME,OAAOS,KAAP,EAAc;AACdR,QAAAA,MAAM,CAACQ,KAAD,CAAN;AACD;AACF,KAV0B,CAAJ;AAAA,GAAhB,CAAP;AAWD;;AAED,SAASzB,oBAAT,CAA8BE,WAA9B,EAA2C;AACzC,MAAI,OAAOI,iBAAP,KAA6B,WAAjC,EAA8C;AAC5C,WAAO,IAAP;AACD;;AACD,SAAOX,kBAAkB,CAACO,WAAD,CAAzB;AACD;;AAED,SAASD,mBAAT,CAA6BM,GAA7B,EAAkCC,OAAlC,EAA2C;AACzC,SAAOV,eAAe,CAACS,GAAD,EAAMC,OAAN,CAAtB;AACD","sourcesContent":["/* global Image, Blob, createImageBitmap */\nimport {readFile} from '../read-file/read-file';\n\n// Specifically loads an ImageBitmap (works on newer browser main and worker threads)\nexport const ImageBitmapLoader = {\n  parse: parseToImageBitmap\n};\n\n// Specifically loads an HTMLImage (works on alls browser main threads but not on worker threads)\nexport const HTMLImageLoader = {\n  load: loadToHTMLImage\n};\n\n// Loads a platform-specific image type that can be used as input data to WebGL textures\nexport const PlatformImageLoader = {\n  parse: parseToPlatformImage,\n  load: loadToPlatformImage\n};\n\n// TODO - export functions that work on \"platform images\",\n// e.g. extracts image data as typed array from any of the platform image formats.\n\n// Asynchronously parses an array buffer into an ImageBitmap - this contains the decoded data\nfunction parseToImageBitmap(arrayBuffer) {\n  const blob = new Blob([new Uint8Array(arrayBuffer)]);\n  return createImageBitmap(blob);\n}\n\nfunction loadToHTMLImage(url, options) {\n  let promise;\n  if (/\\.svg((\\?|#).*)?$/.test(url)) {\n    // is SVG\n    promise = readFile(url, {dataType: 'text'})\n      .then(xml => `data:image/svg+xml;charset=utf-8,${xml}`);\n  } else {\n    promise = Promise.resolve(url);\n  }\n  return promise.then(src => new Promise((resolve, reject) => {\n    try {\n      const image = new Image();\n      image.onload = () => resolve(image);\n      image.onerror = (err) => reject(new Error(`Could not load image ${url}: ${err}`));\n      image.crossOrigin = (options && options.crossOrigin) || 'anonymous';\n      image.src = src;\n    } catch (error) {\n      reject(error);\n    }\n  }));\n}\n\nfunction parseToPlatformImage(arrayBuffer) {\n  if (typeof createImageBitmap === 'undefined') {\n    return null;\n  }\n  return parseToImageBitmap(arrayBuffer);\n}\n\nfunction loadToPlatformImage(url, options) {\n  return loadToHTMLImage(url, options);\n}\n"],"file":"image-loaders.js"}